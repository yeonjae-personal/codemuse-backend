<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Copyright (c) 2023. Lorem ipsum dolor sit amet, consectetur adipiscing elit.
  ~ Morbi non lorem porttitor neque feugiat blandit. Ut vitae ipsum eget quam lacinia accumsan.
  ~ Etiam sed turpis ac ipsum condimentum fringilla. Maecenas magna.
  ~ Proin dapibus sapien vel ante. Aliquam erat volutpat. Pellentesque sagittis ligula eget metus.
  ~ Vestibulum commodo. Ut rhoncus gravida arcu.
  -->

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ui-multi-lang-label-m">
	
	<select id="findByProperties" resultType="com.lgcns.svcp.prod.entity.MultiLangLabelEntity">
		select t.label_id, t.lang_code, t.region_code, t.label_name, t.label_type,
			   t.rgst_user, t.rgst_dtm, t.upd_user, t.upd_dtm
		from tb_multi_lang_label_m t where t.label_type = 'Additional'
		<if test="langCode != null">
			and t.lang_code = #{langCode}
		</if>
		<if test="labelId != null">
			and t.label_id in 
			(select distinct label_id from tb_multi_lang_label_m where lower(label_id) like <![CDATA[ CONCAT('%', #{labelId},'%')]]> and label_type = 'Additional')
		</if>
		<if test="labelName != null">
			and t.label_id in 
			(select distinct label_id from tb_multi_lang_label_m where lower(label_name) like <![CDATA[ CONCAT('%', #{labelName},'%')]]> and label_type = 'Additional')
		</if>
		order by t.label_id desc
	</select>
	
	<select id="findByLabelId" resultType="com.lgcns.svcp.prod.ui.prod.dto.label.LabelItemDto">
		select t.lang_code, t.region_code, t.label_name
		from tb_multi_lang_label_m t where t.label_id = #{labelId} and t.label_type = 'Additional'
	</select>
	
	<insert id ="insert">
		INSERT INTO tb_multi_lang_label_m
			(label_id, lang_code, region_code, label_name, label_type, rgst_user, rgst_dtm, upd_user, upd_dtm)
		VALUES (#{labelId}, #{langCode}, #{regionCode}, #{labelName}, #{labelType}, #{rgstUser}, now(), #{updUser}, now())
	</insert>
	
	<update id ="update">
		UPDATE tb_multi_lang_label_m
		<set>
			label_name = #{labelName},
			upd_user = #{updUser},
			upd_dtm = now()
		</set>
		WHERE label_id = #{labelId} and lang_code = #{langCode} and region_code = #{regionCode} and label_type = 'Additional'
	</update>
		
	<delete id="delete">
        DELETE
        FROM tb_multi_lang_label_m
        WHERE label_id = #{labelId} and label_type = 'Additional'
    </delete>
    
    <delete id="deleteInUpdate">
        DELETE
        FROM tb_multi_lang_label_m
        WHERE label_id = #{labelId} and lang_code = #{langCode} and region_code = #{regionCode}
        and label_type = 'Additional'
    </delete>
    
    <select id="findLabelIds" resultType="java.lang.String">
		SELECT label_id
        FROM tb_multi_lang_label_m t where t.label_type = 'Additional'
		order by label_id desc
	</select>
	
	<select id="findLanguageI18n" resultType="com.lgcns.svcp.prod.entity.MultiLangLabelEntity">
		select t.label_id, t.label_name, t.lang_code			  
		from tb_multi_lang_label_m t where t.label_type = 'Additional' or t.label_type is null
	</select>
	
	<select id="checkLabelExistImportExcel" resultType="int">
		SELECT count(*)
		FROM tb_multi_lang_label_m t where t.label_id = #{labelId} and t.lang_code = #{langCode} and t.region_code = #{regionCode}
	</select>
	
	<update id ="updateFromExcel">
		UPDATE tb_multi_lang_label_m
		<set>
			label_name = #{labelName},
			upd_user = #{updUser},
			upd_dtm = now()
		</set>
		WHERE label_id = #{labelId} and lang_code = #{langCode} and region_code = #{regionCode}
	</update>
</mapper>