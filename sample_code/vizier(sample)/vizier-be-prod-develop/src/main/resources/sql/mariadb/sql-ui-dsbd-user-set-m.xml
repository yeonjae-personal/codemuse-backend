<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Copyright (c) 2023. Lorem ipsum dolor sit amet, consectetur adipiscing elit.
  ~ Morbi non lorem porttitor neque feugiat blandit. Ut vitae ipsum eget quam lacinia accumsan.
  ~ Etiam sed turpis ac ipsum condimentum fringilla. Maecenas magna.
  ~ Proin dapibus sapien vel ante. Aliquam erat volutpat. Pellentesque sagittis ligula eget metus.
  ~ Vestibulum commodo. Ut rhoncus gravida arcu.
  -->

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ui-dsbd-user-set-m">

	<insert id ="insert">
		INSERT INTO tb_dsbd_user_set_m
			(dsbd_view_uuid, user_id, attr_key, seq_no, attr_val, rgst_user, rgst_dtm, upd_user, upd_dtm)
		VALUES (#{dsbdViewUuid}, #{userId}, #{attrKey}, #{seqNo}, #{attrVal}, #{rgstUser}, now(), #{updUser}, now())
	</insert>
	
	<update id ="updateTemporary">
		UPDATE tb_dsbd_user_set_m
		<set>
			attr_val = #{attrVal}
		</set>
		WHERE 1 = 1
		<if test="dsbdViewUuid != null">
			and dsbd_view_uuid = #{dsbdViewUuid}
		</if>
		<if test="userId != null">
			and user_id = #{userId}
		</if>
		<if test="seqNo != null">
			and seq_no = #{seqNo}
		</if>
		<if test="attrKey != null">
			and attr_key = #{attrKey}
		</if>
	</update>
	
	<delete id="deleteByProperties">
        DELETE
        FROM tb_dsbd_user_set_m where 1 = 1
        <if test="userId != null">
			and user_id = #{userId}
		</if>
		<if test="seqNo != null">
			and seq_no = #{seqNo}
		</if> 
        <if test="dsbdViewUuid != null">
			and dsbd_view_uuid = #{dsbdViewUuid}
		</if>
        <if test="attrKey != null">
			and attr_key = #{attrKey}
		</if>
        <if test="attrVal != null">
			and attr_val = #{attrVal}
		</if>
    </delete>
    
	<select id="findByProperties" resultType="com.lgcns.svcp.prod.entity.DsbdUserSetEntity">
		SELECT
			 dsbd_view_uuid, user_id, seq_no, attr_val, attr_key, rgst_user, rgst_dtm, upd_user, upd_dtm
		FROM
			 tb_dsbd_user_set_m	        
		where 1 = 1
		<if test="dsbdViewUuid != null">
			and dsbd_view_uuid = #{dsbdViewUuid}
		</if>
		<if test="userId != null">
			and user_id = #{userId}
		</if>
		<if test="seqNo != null">
			and seq_no = #{seqNo}
		</if>
		<if test="attrKey != null">
			and attr_key = #{attrKey}
		</if>
		<if test="attrVal != null">
			and attr_val = #{attrVal}
		</if>
		<if test="sorting != null">
			order by
			<foreach collection="sorting" item="item">
                     ${item}
            </foreach>
		</if>
	</select>
	
	<select id="countByProperty" resultType="int">
		SELECT count(*)
        FROM tb_dsbd_user_set_m 
        WHERE 1 = 1 
        <if test="dsbdViewUuid != null">
			and dsbd_view_uuid = #{dsbdViewUuid}
		</if>
		<if test="userId != null">
			and user_id = #{userId}
		</if>
		<if test="seqNo != null">
			and seq_no = #{seqNo}
		</if>
		<if test="attrKey != null">
			and attr_key = #{attrKey}
		</if>
		<if test="attrVal != null">
			and attr_val = #{attrVal}
		</if>
	</select>
	
	<select id="findSeqs" resultType="int">
		SELECT seq_no
        FROM tb_dsbd_user_set_m 
        where dsbd_view_uuid = #{dsbdViewUuid}
		and user_id = #{userId}
		and attr_key = #{attrKey}
		order by seq_no desc
	</select>
    
    <delete id="deleteCalendarBySeq">
        DELETE
        FROM tb_dsbd_user_set_m
        WHERE user_id = #{userId} and dsbd_view_uuid = #{dsbdViewUuid} and seq_no = #{seqNo} and attr_key like '%cal%'
    </delete>
    
    <select id="findListDateByMonthAndYear" resultType="string">
		SELECT attr_val
        FROM tb_dsbd_user_set_m 
        where dsbd_view_uuid = #{dsbdViewUuid}
		and user_id = #{userId} and attr_key = #{attrKey}
		and month(attr_val) = #{monthInput} and year(attr_val) = #{yearInput};
	</select>
</mapper>