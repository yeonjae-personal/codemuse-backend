<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="UI">

  <select id="selectMenu" resultType="com.lgcns.svcp.prod.ui.prod.dto.Menu">
    <![CDATA[
    SELECT menu_id
    , menu_nm
    , hpos_menu_id
    , menu_lv
    , menu_icon_path
    , vald_strt_dtm
    , vald_end_dtm
    , rgst_usr
    , rgst_dtm
    , upd_usr
    , upd_dtm
    , page_path
    , use_yn
    , sort_no
    FROM tb_menu_m
    WHERE 1 = 1
    AND   menu_id = #{menuId}
    ]]>
  </select>

  <select id="retrieveMenuTree" resultType="com.lgcns.svcp.prod.ui.prod.dto.Menu">
    <![CDATA[
    SELECT menu_id
    , menu_nm
    , hpos_menu_id
    , menu_lv
    , menu_icon_path
    , vald_strt_dtm
    , vald_end_dtm
    , rgst_usr
    , rgst_dtm
    , upd_usr
    , upd_dtm
    , page_path
    , use_yn
    , sort_no
    FROM tb_menu_m
    WHERE 1 = 1
    AND  use_yn = 'Y'
    ORDER BY menu_lv, sort_no
    ]]>
  </select>

  <select id="insertMenu" resultType="map">
    <![CDATA[
    INSERT INTO tb_menu_m
    (menu_nm, hpos_menu_id, menu_lv, menu_icon_path, vald_strt_dtm, vald_end_dtm, rgst_usr, rgst_dtm, upd_usr, upd_dtm)
    VALUES (#{menuNm}, #{hposMenuId}, #{menuLv}, #{menuIconPath}, CURRENT_TIMESTAMP, NULL, 'prod', CURRENT_TIMESTAMP, 'prod', CURRENT_TIMESTAMP)
    ]]>
  </select>

  <update id="updateMenu">
    UPDATE tb_menu_m
    <set>
    <if test="menuNm != null">
    menu_nm = #{menuNm},
    </if>
    <if test="hposMenuId != null">
    hpos_menu_id = #{hposMenuId},
    </if>
    <if test="menuLv != null">
    menu_lv = #{menuLv},
    </if>
    <if test="menuIconPath != null">
    <![CDATA[
    menu_icon_path = #{menuIconPath},
    ]]>
    </if>
    upd_dtm = CURRENT_TIMESTAMP
    </set>
    WHERE 1 = 1
    AND   menu_id = #{menuId}
  </update>

  <select id="deleteMenu" resultType="map">
    <![CDATA[
    DELETE
    FROM tb_menu_m
    WHERE 1 = 1
    AND   menu_id = #{menuId}
    ]]>
  </select>

  <select id="retrieveAdditionalMetadata" resultType="com.lgcns.svcp.prod.ui.prod.dto.common.metadata.AdditionalDetailDto">
    SELECT a.attr_uuid
    , a.item_code
    , a.field_type_code
    , a.comm_group_code
    , a.attr_ref_table_name
    , a.sort_no
    , a.attr_max_length
    , a.required_yn
    , a.label_id AS label_id
    FROM tb_add_attr_header_m a
    WHERE 1 = 1
    AND   a.item_code = #{itemCode}
    ORDER BY a.sort_no
  </select>

  <select id="getAdditionalByItem" resultType="com.lgcns.svcp.prod.ui.prod.dto.attribute.AttributeAdditionalDto">
    SELECT a.attr_uuid
    , a.item_code
    , a.field_type_code
    , a.comm_group_code
    , a.sort_no
    , a.use_yn
    , a.attr_max_length
    , a.required_yn
    , a.label_id
    , a.disp_tab
    , a.disp_card_yn
    , a.adv_search_yn
    FROM tb_add_attr_header_m a
    WHERE 1 = 1
    AND   a.item_code = #{itemCode}
    ORDER BY a.sort_no ASC
  </select>

</mapper>