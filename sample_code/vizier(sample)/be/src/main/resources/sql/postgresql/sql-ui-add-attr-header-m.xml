<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ui-add-attr-header-m">

  <select id="findByProperties" resultType="com.lgcns.svcp.prod.ui.prod.dto.customvalidation.AttributeNewDto">
    select t1.attr_uuid, t2.lctgr_item_code as largeItemCode, t2.mctgr_item_code, t1.item_code, t1.sort_no, t1.comm_group_code,
    t1.field_type_code, t1.label_id, t2.item_code_name, t2.lctgr_item_code as large_item_code,
    t1.required_yn, t1.disp_tab, t1.attr_max_length
    FROM tb_add_attr_header_m t1
    inner join tb_item_c t2 on t2.item_code = t1.item_code
    where 1 = 1 and (t1.field_type_code != 'TF' AND t1.field_type_code != 'TA' AND t1.field_type_code != 'OB')
    <if test="lctgrItemCode != null">
    and t2.lctgr_item_code = #{lctgrItemCode}
    </if>
    <if test="mctgrItemCode != null">
    and t2.mctgr_item_code = #{mctgrItemCode}
    </if>
    <if test="itemCode != null">
    and t2.item_code = #{itemCode}
    </if>
    <if test="attrUuid != null">
    and t1.attr_uuid = #{attrUuid}
    </if>
    <if test="useYn != null">
    and t1.use_yn = #{useYn}
    </if>
    order by disp_tab desc , sort_no
  </select>

  <select id="countByLabelId" resultType="int">
    SELECT count(*)
    FROM tb_add_attr_header_m t
    WHERE t.label_id = #{labelId}
  </select>

  <insert id="insert">
	INSERT INTO tb_add_attr_header_m
    (attr_uuid,item_code,field_type_code,comm_group_code,sort_no,use_yn,attr_max_length,required_yn,disp_tab,disp_card_yn,label_id,adv_search_yn, rgst_user, rgst_dtm, upd_user, upd_dtm)
    VALUES (gen_random_uuid(), #{itemCode}, #{fieldTypeCode}, #{commGroupCode}, #{sortNo}, #{useYn}, #{attrMaxLength}, #{requiredYn}, #{dispTab}, #{dispCardYn}, #{labelId}, #{advSearchYn}, #{rgstUser}, CURRENT_TIMESTAMP, #{updUser}, CURRENT_TIMESTAMP)
	</insert>

  <select id="countByLabelIdAndItemCode" resultType="int">
    SELECT count(*)
    FROM tb_add_attr_header_m t
    WHERE t.label_id = #{labelId} and t.item_code = #{itemCode}
  </select>

  <update id="update">
	UPDATE tb_add_attr_header_m
    <set>
    item_code = #{itemCode},
    field_type_code = #{fieldTypeCode},
    comm_group_code = #{commGroupCode},
    sort_no = #{sortNo},
    use_yn = #{useYn},
    attr_max_length = #{attrMaxLength},
    required_yn = #{requiredYn},
    disp_tab = #{dispTab},
    disp_card_yn = #{dispCardYn},
    label_id = #{labelId},
    adv_search_yn = #{advSearchYn},
    upd_user = #{updUser},
    upd_dtm = CURRENT_TIMESTAMP
    </set>
    WHERE attr_uuid = #{attrUuid}
	</update>

  <select id="findByItemCode" resultType="com.lgcns.svcp.prod.ui.prod.dto.attribute.AttributeAdditionalDto">
    select t.attr_uuid, t.field_type_code, t.disp_card_yn
    FROM tb_add_attr_header_m t
    where t.item_code = #{itemCode}
  </select>

</mapper>